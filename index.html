<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>คำนวณราคาม่านม้วน (หน้าแรก)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="p-4">
  <h2 class="fw-bold mb-3 text-center">คำนวณราคาม่านม้วน (หน้าแรก)</h2>
  <div class="row g-3 align-items-end">
    <div class="col-md-6">
      <label class="form-label">เลือกผ้า/ชุดราคา</label>
      <select id="rbPrice" class="form-select"></select>
    </div>
    <div class="col-md-6 text-md-end">
      <button id="addRow" class="btn btn-outline-primary">เพิ่มบรรทัด</button>
      <button id="calcBtn" class="btn btn-primary ms-2">คำนวนราคา</button>
    </div>
  </div>

  <div class="card mt-4 shadow-sm border-0">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table align-middle" id="calcTable">
          <thead>
            <tr class="table-light">
              <th>ลำดับ</th><th>รหัสสินค้า</th><th>เลือกผ้า/ราคา</th><th>ปรับ</th><th>กว้าง (ซม.)</th><th>สูง (ซม.)</th><th>จำนวนชุด</th><th class="text-end">ราคารวม</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="text-end fw-bold fs-5 mt-3">ยอดรวมสุทธิ: <span id="grandTotal">0.00</span> บาท</div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const ROLLER_GROUPS = [
  {
    "group": "Dimout • SOLIX",
    "price": 290,
    "codes": [
      "TML-5161",
      "TML-5162",
      "TML-5163",
      "TML-5164",
      "TML-5165"
    ]
  },
  {
    "group": "Dimout • SHEERO",
    "price": 290,
    "codes": [
      "TM-5101",
      "TM-5103",
      "TM-5104",
      "TM-5121",
      "TM-5122",
      "TM-5123",
      "TM-5124"
    ]
  },
  {
    "group": "Dimout • ARISO",
    "price": 349,
    "codes": [
      "MED-0062",
      "MED-0064",
      "MED-0065",
      "MED-0066",
      "MED-0067"
    ]
  },
  {
    "group": "Sunscreen • LUMI 3%",
    "price": 280,
    "codes": [
      "RSP301",
      "RSP302",
      "RSP303",
      "RSP311"
    ]
  },
  {
    "group": "Sunscreen • LUMI 5%",
    "price": 280,
    "codes": [
      "RSP501",
      "RSP502",
      "RSP503",
      "RSP505",
      "RPS506",
      "RSP509",
      "RSP510",
      "RSP511",
      "RSP512"
    ]
  },
  {
    "group": "Blackout 100% • AUROSUN",
    "price": 399,
    "codes": [
      "A5-0002",
      "A5-0003",
      "A5-0004",
      "A5-0005",
      "A5-0006",
      "A5-0007",
      "A5-0008"
    ]
  },
  {
    "group": "Blackout 100% • BUOVI",
    "price": 399,
    "codes": [
      "SZH-0021",
      "SZH-0022",
      "SZH-0024",
      "SZH-0028",
      "SZH-0029"
    ]
  },
  {
    "group": "Blackout 100% • KOALA NOVA",
    "price": 280,
    "codes": [
      "RBP-3901",
      "RBP-3902",
      "RBP-3903",
      "RBP-3908",
      "RBP-3909",
      "RBP-3910",
      "RBP-3911",
      "RBP-3912",
      "RBP-3913",
      "RBP-3914"
    ]
  },
  {
    "group": "Black out Promotion",
    "price": 259,
    "codes": [
      "RBP-3901",
      "RBP-3902",
      "RBP-3903",
      "RBP-3908",
      "RBP-3909",
      "RBP-3910",
      "RBP-3911",
      "RBP-3912",
      "RBP-3913",
      "RBP-3914"
    ]
  }
];

function refreshRBPrices(){
  const sel = document.getElementById('rbPrice');
  sel.innerHTML = ROLLER_GROUPS.map((g,idx)=>`<option value="${g.price}" data-idx="${idx}">${g.group} – ${g.price} บาท</option>`).join('');
}
refreshRBPrices();

const tbody=document.querySelector('#calcTable tbody');
let rowCount=0;
function newRow(){
  if(rowCount>=100) return;
  rowCount++;
  const idxSel=document.getElementById('rbPrice').selectedIndex;
  const dlId='dl_'+rowCount;
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${rowCount}</td>
    <td><input type="text" class="form-control form-control-sm code" list="${dlId}"><datalist id="${dlId}"></datalist></td>
    <td><select class="form-select form-select-sm priceSel">${document.getElementById('rbPrice').innerHTML}</select></td>
    <td><select class="form-select form-select-sm sideSel"><option value="ซ้าย">ซ้าย</option><option value="ขวา">ขวา</option></select></td>
    <td><input type="number" class="form-control form-control-sm wVal"></td>
    <td><input type="number" class="form-control form-control-sm hVal"></td>
    <td><input type="number" class="form-control form-control-sm qtyVal" value="1"></td>
    <td class="text-end lineTotal">0.00</td>`;
  tbody.appendChild(tr);
  const priceSel=tr.querySelector('.priceSel');
  const dl=tr.querySelector('datalist');
  function updateCodes(){
    const idx=priceSel.selectedIndex;
    const codes=ROLLER_GROUPS[idx]?.codes||[];
    dl.innerHTML=codes.map(c=>`<option value="${c}"></option>`).join('');
  }
  priceSel.addEventListener('change',updateCodes);
  updateCodes();
}
newRow();
document.getElementById('addRow').addEventListener('click',newRow);

function calcAll(){
  let grand=0;
  [...tbody.querySelectorAll('tr')].forEach(tr=>{
    const w=(parseFloat(tr.querySelector('.wVal').value)||0)/100;
    const h=(parseFloat(tr.querySelector('.hVal').value)||0)/100;
    const qty=parseInt(tr.querySelector('.qtyVal').value)||0;
    const price=parseFloat(tr.querySelector('.priceSel').value)||0;
    const total=w*h*1.2*price*qty;
    tr.querySelector('.lineTotal').textContent=total.toFixed(2);
    grand+=total;
  });
  document.getElementById('grandTotal').textContent=grand.toFixed(2);
}
document.getElementById('calcBtn').addEventListener('click',calcAll);
</script>
</body></html>
